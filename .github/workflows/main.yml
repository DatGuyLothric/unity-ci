name: Build for target platforms

on:
  push:
    branches:
      - master

jobs:
  buildForTargetPlatforms:
    name: Build
    runs-on: macos-11
    steps:
      - name: Checkout repo
        uses: actions/checkout@v2
        with:
          path: project
    
      - name: Cache Unity installer
        uses: DarGuyLothric/unity-build@master
        with:
          target_platforms: 'macOS|Windows'
          changeset: '816252c3efbb'
          version: '2022.1.0a12'
          serial: '${{ secrets.ACTIVATION }}'
          username: '${{ secrets.LOGIN }}'
          password: '${{ secrets.PASSWORD }}'
          project_path: './project'
          build_script: 'Editor.BuildHelper.PerformBuild'

      - name: Expose as artifact
        uses: actions/upload-artifact@v2
        with:
          name: app
          path: ./builds
